  // تهيئة Pi SDK مع تفعيل وضع الاختبار
  Pi.init({
    version: "2.0",
    sandbox: true
  });

  document.getElementById("payBtn").onclick = async () => {
    const status = document.getElementById("status");

    try {
      // خطوة المصادقة الضرورية لفتح المحفظة
      const scopes = ['username'];
      const auth = await Pi.authenticate(scopes, onIncompletePaymentFound);
      
      status.innerText = "جاري فتح المحفظة...";

      await Pi.createPayment(
        {
          amount: 1,
          memo: "اختبار معاملات التست نت",
          metadata: { purpose: "testnet_10_payments" }
        },
        {
          onReadyForServerApproval: (paymentId) => {
            // توجيه التأكيد لملف approve.js الموجود في مجلد api
            return fetch('/api/approve', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ paymentId })
            });
          },
          onReadyForServerCompletion: (paymentId, txid) => {
            status.innerText = "✅ تمت العملية بنجاح! TXID: " + txid;
          },
          onCancel: () => {
            status.innerText = "❌ تم إلغاء العملية";
          },
          onError: (err) => {
            status.innerText = "⚠️ خطأ: " + err.message;
          }
        }
      );

    } catch (e) {
      status.innerText = "❌ فشل: تأكد من فتح التطبيق من متصفح Pi";
    }
  };

  function onIncompletePaymentFound(payment) {
    // وظيفة للتعامل مع أي مدفوعات معلقة
  };
